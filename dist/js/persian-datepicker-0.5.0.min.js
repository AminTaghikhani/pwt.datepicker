/*
  persian-datepicker - v0.5.0 
  Author: reza babakhani 
 http://babakhani.github.io/PersianWebToolkit/datepicker 
 */
(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);e.length>t;t++)n[t]=e[t];return n}return Array.from(e)}function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n={monthRange:[{index:1,name:{fa:"فروردین"},abbr:{fa:"فرو"}},{index:2,name:{fa:"اردیبهشت"},abbr:{fa:"ارد"}},{index:3,name:{fa:"خرداد"},abbr:{fa:"خرد"}},{index:4,name:{fa:"تیر"},abbr:{fa:"تیر"}},{index:5,name:{fa:"مرداد"},abbr:{fa:"مرد"}},{index:6,name:{fa:"شهریور"},abbr:{fa:"شهر"}},{index:7,name:{fa:"مهر"},abbr:{fa:"مهر"}},{index:8,name:{fa:"آبان"},abbr:{fa:"آبا"}},{index:9,name:{fa:"آذر"},abbr:{fa:"آذر"}},{index:10,name:{fa:"دی"},abbr:{fa:"دی"}},{index:11,name:{fa:"بهمن"},abbr:{fa:"بهم"}},{index:12,name:{fa:"اسفند"},abbr:{fa:"اسف"}}],weekRange:{0:{name:{fa:"شنبه"},abbr:{fa:"ش"}},1:{name:{fa:"یکشنبه"},abbr:{fa:"ی"}},2:{name:{fa:"دوشنبه"},abbr:{fa:"د"}},3:{name:{fa:"سه شنبه"},abbr:{fa:"س"}},4:{name:{fa:"چهار شنبه"},abbr:{fa:"چ"}},5:{name:{fa:"پنج شنبه"},abbr:{fa:"پ"}},6:{name:{fa:"جمعه"},abbr:{fa:"ج"}}},persianDaysName:["اورمزد","بهمن","اوردیبهشت","شهریور","سپندارمذ","خورداد","امرداد","دی به آذز","آذز","آبان","خورشید","ماه","تیر","گوش","دی به مهر","مهر","سروش","رشن","فروردین","بهرام","رام","باد","دی به دین","دین","ارد","اشتاد","آسمان","زامیاد","مانتره سپند","انارام","زیادی"]},i={isSameDay:function(e,t){return e&&t&&e.date()==t.date()&&e.year()==t.year()&&e.month()==t.month()},isSameMonth:function(e,t){return e&&t&&e.year()==t.year()&&e.month()==t.month()}},a=function a(e,t){var n=parseInt(1e3*Math.random(100));return this.id="persianDateInstance-"+n,this.$container=$('<div  id="'+this.id+'" class="datepicker-container"></div>').appendTo("body"),this.inputElement=e,this.initialUnix=null,this.options=new d(t),this.state=new l(this),this.view=new f(this),this.toolbox=new h(this),this._defineOnInitState=function(){var e=null;return this.initialUnix=null,e="INPUT"===$(this.$container)[0].nodeName?new Date(this.inputElement.getAttribute("value")).valueOf():new Date($(this.$container).data("date")).valueOf(),this.initialUnix=e&&"undefined"!=e?e:(new Date).valueOf(),this},this.selectDate=function(t){$(e).val(new pDate(t).format())},this._updateStateOnInit=function(){this.state.updateView("unix",this.initialUnix)},this._defineOnInitState(),this._updateStateOnInit(),this.navigator=new o(t,this),{datepicker:this,state:this.state}},r={initialValue:!0,persianDigit:!0,viewMode:"day",position:"auto",autoClose:!1,format:!1,observer:!1,inputDelay:800,formatter:function(e){var t=this,n=new persianDate(e);return n.formatPersian=!1,n.format(t.format)},altField:!1,altFormat:"unix",altFieldFormatter:function(e){var t=this,n=t.altFormat.toLowerCase();return"gregorian"===n||"g"===n?new Date(e):"unix"===n||"u"===n?e:new persianDate(e).format(t.altFormat)},show:function(){return this.view.fixPosition(this),this.element.main.show(),this.onShow(this),this._viewed=!0,this},hide:function(){return this._viewed&&(this.element.main.hide(),this.onHide(this),this._viewed=!1),this},destroy:function(){this.inputElem.removeClass(self.cssClass),this.element.main.remove()},onShow:function(){},onHide:function(){},onSelect:function(){return this},navigator:{enabled:!0,text:{btnNextText:"<",btnPrevText:">"},switchFormat:"YYYY MMMM",onNext:function(){},onPrev:function(){},onSwitch:function(){}},toolbox:{enabled:!0,text:{btnToday:"امروز"},onToday:function(){}},timePicker:{enabled:!1,showSeconds:!0,showMeridian:!0,secondStep:1,minuteStep:1,hourStep:1,scrollEnabled:!0,changeOnScroll:!0},dayPicker:{enabled:!0,scrollEnabled:!0,titleFormat:"YYYY MMMM",titleFormatter:function(e,t){this.datepicker.options.persianDigit===!1&&(window.formatPersian=!1);var n=new persianDate([e,t]).format(this.datepicker.options.dayPicker.titleFormat);return window.formatPersian=!0,n},onSelect:function(){}},monthPicker:{enabled:!0,scrollEnabled:!0,titleFormat:"YYYY",titleFormatter:function(e){this.datepicker.options.persianDigit===!1&&(window.formatPersian=!1);var t=new persianDate(e).format(this.datepicker.options.monthPicker.titleFormat);return window.formatPersian=!0,t},onSelect:function(){}},yearPicker:{enabled:!0,scrollEnabled:!0,titleFormat:"YYYY",titleFormatter:function(e){var t=12*parseInt(e/12,10);return t+"-"+(t+11)},onSelect:function(){}},onlyTimePicker:!1,justSelectOnDate:!0,minDate:null,maxDate:null,checkDate:function(){return!0},checkMonth:function(){return!0},checkYear:function(){return!0}},s=function(){function e(e,t){for(var n=0;t.length>n;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function t(n,i){e(this,t),this.datepicker=i,this._attachEvents()}return s(t,[{key:"getSwitchText",value:function(){}},{key:"_attachEvents",value:function(){var e=this;$(document).on("click","#"+e.datepicker.id+" .btn",function(){$(this).is(".btn-next")?e.datepicker.state.navigate("next"):$(this).is(".btn-switch")?e.datepicker.state.switchViewMode():$(this).is(".btn-prev")&&e.datepicker.state.navigate("prev")}),$(document).on("click","#"+e.datepicker.id+" .datepicker-day-view td",function(){var t=$(this).data("unix");e.datepicker.state.setSelectedDateTime("unix",t),e.datepicker.state.updateView("unix",t)}),$(document).on("click","#"+e.datepicker.id+" .datepicker-month-view .month-item",function(){e.datepicker.state.switchViewModeTo("day"),e.datepicker.options.justSelectOnDate||e.datepicker.state.setSelectedDateTime("month",$(this).data("month")),e.datepicker.state.updateView("month",$(this).data("month"))}),$(document).on("click","#"+e.datepicker.id+" .datepicker-year-view .year-item",function(){e.datepicker.state.switchViewModeTo("month"),e.datepicker.options.justSelectOnDate||e.datepicker.state.setSelectedDateTime("year",$(this).data("year")),e.datepicker.state.updateView("year",$(this).data("year"))})}}]),t}(),d=function d(t){return e(this,d),$.extend(!0,this,r,t)};(function(e){e.fn.persianDatepicker=e.fn.pDatepicker=function(t){var n=Array.prototype.slice.call(arguments),i=null,r=this;return this||e.error("Invalid selector"),e(this).each(function(){var s=[],o=n.concat(s),d=e(this).data("datepicker"),l=null;d&&"string"==typeof o[0]?(l=o[0],i=d[l](o[0])):r.pDatePicker=new a(this,t)}),e(this).data("datepicker",r.pDatePicker),this}})(jQuery);var s=function(){function e(e,t){for(var n=0;t.length>n;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(){function t(n){return e(this,t),this.datepicker=n,this.filetredDate=this.datepicker.options.minDate||this.datepicker.options.maxDate,this.viewModeList=["day","month","year"],this.viewMode=n.options.viewMode,this.viewModeIndex=this.viewModeList.indexOf(n.options.viewMode),this.filterDate={start:{year:0,month:0,date:0,hour:0,minute:0,second:0,unixDate:0},end:{year:0,month:0,date:0,hour:0,minute:0,second:0,unixDate:0}},this.view={year:0,month:0,date:0,hour:0,minute:0,second:0,unixDate:0,dateObject:null},this.selected={year:0,month:0,date:0,hour:0,minute:0,second:0,unixDate:0,dateObject:null},this.setFilterDate(this.datepicker.options.minDate,this.datepicker.options.maxDate),this}return s(t,[{key:"setFilterDate",value:function(e,t){var n=this;e||(e=-1e18),t||(t=1e18);var i=new persianDate(e);n.filterDate.start.unixDate=e,n.filterDate.start.hour=i.hour(),n.filterDate.start.minute=i.minute(),n.filterDate.start.second=i.second(),n.filterDate.start.month=i.month(),n.filterDate.start.date=i.date(),n.filterDate.start.year=i.year();var a=new persianDate(t);n.filterDate.end.unixDate=t,n.filterDate.end.hour=a.hour(),n.filterDate.end.minute=a.minute(),n.filterDate.end.second=a.second(),n.filterDate.end.month=a.month(),n.filterDate.end.date=a.date(),n.filterDate.end.year=a.year()}},{key:"setSelectedDateTime",value:function(e,t){var n=this;switch(e){case"unix":n.selected.unixDate=t;var i=new persianDate(t);n.selected.year=i.year(),n.selected.month=i.month(),n.selected.date=i.date(),n.selected.hour=i.hour(),n.selected.minute=i.minute(),n.selected.second=i.second(),n._updateSelectedUnix();break;case"year":this.selected.year=t,n._updateSelectedUnix();break;case"month":this.selected.month=t,n._updateSelectedUnix();break;case"date":this.selected.month=t,n._updateSelectedUnix()}return this}},{key:"_updateSelectedUnix",value:function(){return this.selected.dateObj=new persianDate([this.selected.year,this.selected.month,this.selected.date,this.selected.hour,this.selected.minute,this.selected.second]),this.selected.unixDate=this.selected.dateObj.valueOf(),this.datepicker.selectDate(this.selected.unixDate),this}},{key:"_syncViewModes",value:function(e){this.view.year=e.year(),this.view.month=e.month(),this.view.date=e.date()}},{key:"_updateViewUnix",value:function(){return this.view.dateObj=new persianDate([this.view.year,this.view.month,this.view.date,this.view.hour,this.view.minute,this.view.second]),this._syncViewModes(this.view.dateObj),this.view.unixDate=this.view.dateObj.valueOf(),this.datepicker.view.render(this.view),this}},{key:"navigate",value:function(e){"next"==e?("year"==this.viewMode&&this.updateView("year",this.view.year+12),"month"==this.viewMode&&this.updateView("year",this.view.year+1),"day"==this.viewMode&&(13==this.view.month+1?(this.updateView("year",this.view.year+1),this.updateView("month",1)):this.updateView("month",this.view.month+1))):("year"==this.viewMode&&this.updateView("year",this.view.year-12),"month"==this.viewMode&&this.updateView("year",this.view.year-1),"day"==this.viewMode&&(0>=this.view.month-1?(this.updateView("year",this.view.year-1),this.updateView("month",12)):this.updateView("month",this.view.month-1)))}},{key:"switchViewMode",value:function(){return this.viewModeIndex=this.viewModeIndex+1>=this.viewModeList.length?0:this.viewModeIndex+1,this.viewMode=this.viewModeList[this.viewModeIndex]?this.viewModeList[this.viewModeIndex]:this.viewModeList[0],this._updateViewUnix(),this}},{key:"switchViewModeTo",value:function(e){this.viewMode=e,this.viewModeIndex=this.viewModeList.indexOf(e)}},{key:"updateView",value:function(e,t){var n=this;switch(e){case"unix":var i=new persianDate(t);n.view.year=i.year(),n.view.month=i.month(),n.view.date=i.date();break;case"year":this.view.year=t;break;case"month":this.view.month=t;break;case"date":this.view.month=t}return this._updateViewUnix(),this}}]),t}(),c='\n<div id="plotId" class="datepicker-plot-area datepicker-plot-area-inline-view">\n    {{#navigator.enabled}}\n        <div class="navigator">\n            <div class="datepicker-header">\n                <div class="btn btn-next">&lt;</div>\n                <div class="btn btn-switch">{{ navigator.switch.text }}</div>\n                <div class="btn btn-prev">&gt;</div>\n            </div>\n        </div>\n    {{/navigator.enabled}}\n   \n    {{#days.enabled}}\n        {{#days.viewMode}}\n        <div class="datepicker-day-view" >    \n            <div class="month-grid-box">\n                <div class="header">\n                    <div class="title"></div>\n                    <div class="header-row">\n                        <div class="header-row-cell">ش</div>\n                        <div class="header-row-cell">ی</div>\n                        <div class="header-row-cell">د</div>\n                        <div class="header-row-cell">س</div>\n                        <div class="header-row-cell">چ</div>\n                        <div class="header-row-cell">پ</div>\n                        <div class="header-row-cell">ج</div>\n                    </div>\n                </div>    \n                <table cellspacing="0" class="table-days">\n                    <tbody>\n                        {{#days.list}}\n                           \n                            <tr>\n                                {{#.}}\n                                    \n                                    {{#enabled}}\n                                        <td data-unix="{{dataUnix}}" ><span  class="{{#otherMonth}}other-month{{/otherMonth}} {{#selected}}selected{{/selected}}">{{title}}</span></td>\n                                    {{/enabled}}\n                                    {{^enabled}}\n                                        <td data-unix="{{dataUnix}}" class="disabled"><span class="{{#otherMonth}}other-month{{/otherMonth}}">{{title}}</span></td>\n                                    {{/enabled}}\n                                    \n                                {{/.}}\n                            </tr>\n                        {{/days.list}}\n                    </tbody>\n                </table>\n            </div>\n        </div>\n        {{/days.viewMode}}\n    {{/days.enabled}}\n    \n    {{#month.enabled}}\n        {{#month.viewMode}}\n            <div class="datepicker-month-view">\n                {{#month.list}}\n                    {{#enabled}}               \n                        <div data-month="{{dataMonth}}" class="month-item {{#selected}}selected{{/selected}}">{{title}}</small></div>\n                    {{/enabled}}\n                    {{^enabled}}               \n                        <div data-month="{{dataMonth}}" class="month-item month-item-disable {{#selected}}selected{{/selected}}">{{title}}</small></div>\n                    {{/enabled}}\n                {{/month.list}}\n            </div>\n        {{/month.viewMode}}\n    {{/month.enabled}}\n    \n    {{#year.enabled }}\n        {{#year.viewMode }}\n            <div class="datepicker-year-view" >\n                {{#year.list}}\n                    {{#enabled}}\n                        <div data-year="{{dataYear}}" class="year-item {{#selected}}selected{{/selected}}">{{title}}</div>\n                    {{/enabled}}\n                    {{^enabled}}\n                        <div data-year="{{dataYear}}" class="year-item year-item-disable {{#selected}}selected{{/selected}}">{{title}}</div>\n                    {{/enabled}}                    \n                {{/year.list}}\n            </div>\n        {{/year.viewMode }}\n    {{/year.enabled }}\n    <div class="datepicker-time-view"></div>\n    <div class="toolbox ">\n        <div class="btn-today">امروز</div>\n    </div>\n</div>\n',s=function(){function e(e,t){for(var n=0;t.length>n;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),h=function(){function t(n){return e(this,t),this.datepicker=n,this.attachEvents(),this}return s(t,[{key:"attachEvents",value:function(){var e=this;$(document).on("click",".btn-today",function(){e.datepicker.state.setSelectedDateTime("unix",(new Date).valueOf()),e.datepicker.state.updateView("unix",(new Date).valueOf())})}}]),t}(),u=function(){function e(e,t){var n=[],i=!0,a=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(d){a=!0,r=d}finally{try{!i&&o["return"]&&o["return"]()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function e(e,t){for(var n=0;t.length>n;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),f=function(){function a(t){return e(this,a),this.yearsViewCount=12,this.datepicker=t,this.rendered=null,this}return s(a,[{key:"checkYearAccess",value:function(e){var t=!0;if(this.datepicker.state.filetredDate){var n=this.datepicker.state.filterDate.start.year,i=this.datepicker.state.filterDate.end.year;if(!(e>=n&i>=e))return!1;t=!0}return t?this.datepicker.options.checkYear(e):void 0}},{key:"getYearViewModel",value:function(e){var n=this,i=[].concat(t(Array(this.yearsViewCount).keys())).map(function(t){return t+parseInt(e.year/n.yearsViewCount)*n.yearsViewCount}),a=[],r=!0,s=!1,o=void 0;try{for(var d,l=i[Symbol.iterator]();!(r=(d=l.next()).done);r=!0){var c=d.value;a.push({title:c,enabled:this.checkYearAccess(c),dataYear:c,selected:this.datepicker.state.selected.year==c})}}catch(h){s=!0,o=h}finally{try{!r&&l.return&&l.return()}finally{if(s)throw o}}return{enabled:this.datepicker.options.yearPicker.enabled,viewMode:"year"==this.datepicker.state.viewMode,list:a}}},{key:"checkMonthAccess",value:function(e){var t=!0,n=null;if(this.datepicker.state.filetredDate){n=this.datepicker.state.view.year;var i=this.datepicker.state.filterDate.start.month,a=this.datepicker.state.filterDate.end.month,r=this.datepicker.state.filterDate.start.year,s=this.datepicker.state.filterDate.end.year;if(!((r==s&&s==n&&e>=i&&a>=e)|(n!=s&&n==r&&e>=i)|(n!=r&&n==s&&a>=e)|(n>r&&s>n)))return!1;t=!0}return t?this.datepicker.options.checkMonth(e,n):void 0}},{key:"getMonthViewModel",value:function(){var e=[],t=!0,a=!1,r=void 0;try{for(var s,o=n.monthRange[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var d=s.value;e.push({title:d.name.fa,enabled:this.checkMonthAccess(d.index),year:this.datepicker.state.view.year,dataMonth:d.index,selected:i.isSameMonth(this.datepicker.state.selected.dateObj,new pDate([this.datepicker.state.view.year,d.index]))})}}catch(l){a=!0,r=l}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}return{enabled:this.datepicker.options.monthPicker.enabled,viewMode:"month"==this.datepicker.state.viewMode,list:e}}},{key:"checkDayAccess",value:function(e){var t=this,n=!0;if(t.minDate=this.datepicker.options.minDate,t.maxDate=this.datepicker.options.maxDate,t.datepicker.state.filetredDate)if(t.minDate&&t.maxDate){if(t.minDate=new pDate(t.minDate).startOf("day").valueOf(),t.maxDate=new pDate(t.maxDate).endOf("day").valueOf(),!(e>=t.minDate&&t.maxDate>=e))return!1}else if(t.minDate){if(t.minDate=new pDate(t.minDate).startOf("day").valueOf(),t.minDate>=e)return!1}else if(t.maxDate&&(t.maxDate=new pDate(t.maxDate).endOf("day").valueOf(),t.maxDate>=e))return!1;return n?t.datepicker.options.checkDate(e):void 0}},{key:"getDayViewModel",value:function(){if("day"!=this.datepicker.state.viewMode)return[];var e=this.datepicker.state.view.month,t=this.datepicker.state.view.year,n=new persianDate,a=n.daysInMonth(t,e),r=n.getFirstWeekDayOfMonth(t,e)-1,s=[],o=0,d=0,l=[["null","null","null","null","null","null","null"],["null","null","null","null","null","null","null"],["null","null","null","null","null","null","null"],["null","null","null","null","null","null","null"],["null","null","null","null","null","null","null"],["null","null","null","null","null","null","null"]],c=!0,h=!1,f=void 0;try{for(var p,v=l.entries()[Symbol.iterator]();!(c=(p=v.next()).done);c=!0){var w=u(p.value,2),y=w[0],m=w[1];s[y]=[];var k=!0,b=!1,x=void 0;try{for(var D,g=m.entries()[Symbol.iterator]();!(k=(D=g.next()).done);k=!0){var M=u(D.value,2),O=M[0];if(M[1],0==y&&r>O)var S=new pDate(this.datepicker.state.view.dateObj.startOf("month").valueOf()),V=S.subtract("days",r-O),T=!0;else if(0==y&&O>=r||5>=y&&a>o){o+=1;var V=new pDate([this.datepicker.state.view.year,this.datepicker.state.view.month,o]),T=!1}else{d+=1;var S=new pDate(this.datepicker.state.view.dateObj.endOf("month").valueOf()),V=S.add("days",d),T=!0}s[y].push({title:V.date(),dataUnix:V.valueOf(),selected:i.isSameDay(V,this.datepicker.state.selected.dateObj),otherMonth:T,enabled:this.checkDayAccess(V.valueOf())})}}catch(P){b=!0,x=P}finally{try{!k&&g.return&&g.return()}finally{if(b)throw x}}}}catch(P){h=!0,f=P}finally{try{!c&&v.return&&v.return()}finally{if(h)throw f}}return{enabled:this.datepicker.options.dayPicker.enabled&&"day"==this.datepicker.state.viewMode,viewMode:"day"==this.datepicker.state.viewMode,list:s}}},{key:"getNavSwitchText",value:function(e){var t=void 0;return"day"==this.datepicker.state.viewMode?t=this.datepicker.options.dayPicker.titleFormatter.call(this,e.year,e.month):"month"==this.datepicker.state.viewMode?t=this.datepicker.options.monthPicker.titleFormatter.call(this,e.dateObj.valueOf()):"year"==this.datepicker.state.viewMode&&(t=this.datepicker.options.yearPicker.titleFormatter.call(this,e.year)),t}},{key:"getViewModel",value:function(e){return{plotId:"",navigator:{enabled:this.datepicker.options.navigator.enabled,"switch":{enabled:!0,text:this.getNavSwitchText(e)}},selected:this.datepicker.state.selected,days:this.getDayViewModel(e),month:this.getMonthViewModel(e),year:this.getYearViewModel(e)}}},{key:"render",value:function(e){Mustache.parse(c),this.rendered=$(Mustache.render(c,this.getViewModel(e))),this.datepicker.$container.empty().append(this.rendered)}}]),a}();(function(e,t){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e.Mustache={},t(e.Mustache))})(this,function(e){function t(e){return"function"==typeof e}function n(e){return v(e)?"array":typeof e}function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function a(e,t){return null!=e&&"object"==typeof e&&t in e}function r(e,t){return w.call(e,t)}function s(e){return!r(y,e)}function o(e){return(e+"").replace(/[&<>"'`=\/]/g,function(e){return m[e]})}function d(t,n){function a(){if(y&&!m)for(;w.length;)delete p[w.pop()];else w=[];y=!1,m=!1}function r(e){if("string"==typeof e&&(e=e.split(b,2)),!v(e)||2!==e.length)throw Error("Invalid tags: "+e);o=RegExp(i(e[0])+"\\s*"),d=RegExp("\\s*"+i(e[1])),u=RegExp("\\s*"+i("}"+e[1]))}if(!t)return[];var o,d,u,f=[],p=[],w=[],y=!1,m=!1;r(n||e.tags);for(var M,O,S,V,T,P,E=new h(t);!E.eos();){if(M=E.pos,S=E.scanUntil(o))for(var j=0,U=S.length;U>j;++j)V=S.charAt(j),s(V)?w.push(p.length):m=!0,p.push(["text",V,M,M+1]),M+=1,"\n"===V&&a();if(!E.scan(o))break;if(y=!0,O=E.scan(g)||"name",E.scan(k),"="===O?(S=E.scanUntil(x),E.scan(x),E.scanUntil(d)):"{"===O?(S=E.scanUntil(u),E.scan(D),E.scanUntil(d),O="&"):S=E.scanUntil(d),!E.scan(d))throw Error("Unclosed tag at "+E.pos);if(T=[O,S,M,E.pos],p.push(T),"#"===O||"^"===O)f.push(T);else if("/"===O){if(P=f.pop(),!P)throw Error('Unopened section "'+S+'" at '+M);if(P[1]!==S)throw Error('Unclosed section "'+P[1]+'" at '+M)}else"name"===O||"{"===O||"&"===O?m=!0:"="===O&&r(S)}if(P=f.pop())throw Error('Unclosed section "'+P[1]+'" at '+E.pos);return c(l(p))}function l(e){for(var t,n,i=[],a=0,r=e.length;r>a;++a)t=e[a],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(i.push(t),n=t));return i}function c(e){for(var t,n,i=[],a=i,r=[],s=0,o=e.length;o>s;++s)switch(t=e[s],t[0]){case"#":case"^":a.push(t),r.push(t),a=t[4]=[];break;case"/":n=r.pop(),n[5]=t[2],a=r.length>0?r[r.length-1][4]:i;break;default:a.push(t)}return i}function h(e){this.string=e,this.tail=e,this.pos=0}function u(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function f(){this.cache={}}var p=Object.prototype.toString,v=Array.isArray||function(e){return"[object Array]"===p.call(e)},w=RegExp.prototype.test,y=/\S/,m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},k=/\s*/,b=/\s+/,x=/\s*=/,D=/\s*\}/,g=/#|\^|\/|>|\{|&|=|!/;h.prototype.eos=function(){return""===this.tail},h.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},h.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},u.prototype.push=function(e){return new u(e,this)},u.prototype.lookup=function(e){var n,i=this.cache;if(i.hasOwnProperty(e))n=i[e];else{for(var r,s,o=this,d=!1;o;){if(e.indexOf(".")>0)for(n=o.view,r=e.split("."),s=0;null!=n&&r.length>s;)s===r.length-1&&(d=a(n,r[s])),n=n[r[s++]];else n=o.view[e],d=a(o.view,e);if(d)break;o=o.parent}i[e]=n}return t(n)&&(n=n.call(this.view)),n},f.prototype.clearCache=function(){this.cache={}},f.prototype.parse=function(e,t){var n=this.cache,i=n[e];return null==i&&(i=n[e]=d(e,t)),i},f.prototype.render=function(e,t,n){var i=this.parse(e),a=t instanceof u?t:new u(t);return this.renderTokens(i,a,n,e)},f.prototype.renderTokens=function(e,t,n,i){for(var a,r,s,o="",d=0,l=e.length;l>d;++d)s=void 0,a=e[d],r=a[0],"#"===r?s=this.renderSection(a,t,n,i):"^"===r?s=this.renderInverted(a,t,n,i):">"===r?s=this.renderPartial(a,t,n,i):"&"===r?s=this.unescapedValue(a,t):"name"===r?s=this.escapedValue(a,t):"text"===r&&(s=this.rawValue(a)),void 0!==s&&(o+=s);return o},f.prototype.renderSection=function(e,n,i,a){function r(e){return s.render(e,n,i)}var s=this,o="",d=n.lookup(e[1]);if(d){if(v(d))for(var l=0,c=d.length;c>l;++l)o+=this.renderTokens(e[4],n.push(d[l]),i,a);else if("object"==typeof d||"string"==typeof d||"number"==typeof d)o+=this.renderTokens(e[4],n.push(d),i,a);else if(t(d)){if("string"!=typeof a)throw Error("Cannot use higher-order sections without the original template");d=d.call(n.view,a.slice(e[3],e[5]),r),null!=d&&(o+=d)}else o+=this.renderTokens(e[4],n,i,a);return o}},f.prototype.renderInverted=function(e,t,n,i){var a=t.lookup(e[1]);return!a||v(a)&&0===a.length?this.renderTokens(e[4],t,n,i):void 0},f.prototype.renderPartial=function(e,n,i){if(i){var a=t(i)?i(e[1]):i[e[1]];return null!=a?this.renderTokens(this.parse(a),n,i,a):void 0}},f.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);return null!=n?n:void 0},f.prototype.escapedValue=function(t,n){var i=n.lookup(t[1]);return null!=i?e.escape(i):void 0},f.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.3.0",e.tags=["{{","}}"];var M=new f;return e.clearCache=function(){return M.clearCache()},e.parse=function(e,t){return M.parse(e,t)},e.render=function(e,t,i){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+n(e)+'" was given as the first '+"argument for mustache#render(template, view, partials)");return M.render(e,t,i)},e.to_html=function(n,i,a,r){var s=e.render(n,i,a);return t(r)?(r(s),void 0):s},e.escape=o,e.Scanner=h,e.Context=u,e.Writer=f,e})})();